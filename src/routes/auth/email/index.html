<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Sign in with email | 1Auth</title>
		<meta name="robots" content="noindex, follow, archive, snippet" />
		<link rel="preload" href="/svg/loading" as="image" />
		<noscript>
			<meta http-equiv="refresh" content="0; url=/old/" />
		</noscript>
		{{> googletagmanager}}
	</head>

	<body style="display: none">
		{{> nav}}
		<main>
			<h1>Login with Email</h1>
			<label id="note" for="email-address">Enter your email to continue</label>
			<form action method="POST">
				<input
					id="email-address"
					name="email"
					type="email"
					autocomplete="email"
					required="true"
					placeholder="Email address"
				/>
				<button id="submit" type="submit">Submit</button>
			</form>
		</main>
		<script>
			"use strict";
			(function () {
				const form = document.querySelector("form");
				async function eventListener(event) {
					form.removeEventListener("submit", eventListener);
					event.preventDefault();

					// Show loading icon
					const submit = document.querySelector('[type="submit"]');
					submit.firstChild.remove();
					submit.append(
						Object.assign(document.createElement("img"), {
							src: "/svg/loading",
						}),
					);

					// Save email for later
					const email = document.querySelector("input").value;

					// Send the email
					await fetch("", {
						body: `email=${email}`,
						headers: {
							"content-type": "application/x-www-form-urlencoded; charset=UTF-8",
						},
						method: "POST",
					});

					// Create new form
					const newForm = Object.assign(document.createElement("form"), {
						// Create form element
						action: "",
						autocomplete: "off",
						method: "POST",
					});
					newForm.append(
						Object.assign(document.createElement("input"), {
							// Code box
							autocomplete: "off",
							// eslint-disable-next-line id-length
							id: "code",
							name: "code",
							placeholder: "abcde12345",
							required: "true",
							type: "password",
						}),
						Object.assign(document.createElement("input"), {
							// Hidden email box
							name: "email",
							type: "hidden",
							value: email,
						}),
						Object.assign(document.createElement("input"), {
							// Submit button
							// eslint-disable-next-line id-length
							id: "submit",
							type: "submit",
						}),
					);
					form.remove();
					document.querySelector("#note").remove();
					document.querySelector("main").append(
						Object.assign(document.createElement("label"), {
							htmlFor: "code",
							// eslint-disable-next-line id-length
							id: "note",
							innerText: "Enter the code we sent to you to continue",
						}),
						newForm,
					);
				}
				form.addEventListener("submit", eventListener);
			})();
		</script>
	</body>
</html>
