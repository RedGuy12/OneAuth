<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>{{ #message }}emailHeading{{ /message }} | 1Auth</title>
		<meta name="robots" content="noindex, follow, archive, snippet" />
		<link rel="preload" href="/image/loading.svg" as="image" />
		<noscript>
			<meta http-equiv="refresh" content="0; url=/old/" />
		</noscript>
		{{> head }}
	</head>

	<body style="display: none">
		{{> nav }}
		<main>
			<h1>{{ #message }}emailHeading{{ /message }}</h1>
			<label id="note" for="email-address"
				>{{ #message }}emailEnterPrompt{{ /message }}</label
			>
			<form action method="POST">
				<input
					id="email-address"
					name="email"
					type="email"
					autocomplete="email"
					required="true"
					placeholder="{{ #message }}emailPlaceholder{{ /message }}"
				/>
				<button id="submit" type="submit">{{ #message }}emailSubmit{{ /message }}</button>
			</form>
		</main>
		<script>
			"use strict";
			(function forumHandler() {
				const form = document.querySelector("form");
				/**
				 * Code that submits the form in the background.
				 *
				 * @param {Event} event - The Submit event.
				 */
				async function onSubmit(event) {
					form.removeEventListener("submit", onSubmit);
					event.preventDefault();

					// Show loading icon
					const submit = document.querySelector('[type="submit"]');
					submit.firstChild.remove();
					submit.append(
						Object.assign(document.createElement("img"), {
							src: "/image/loading.svg"
						})
					);

					// Save email address for later
					const email = document.querySelector("input").value;

					// Send the email
					await fetch("", {
						body: `email=${email}`,
						headers: {
							"content-type": "application/x-www-form-urlencoded; charset=UTF-8"
						},
						method: "POST"
					});

					// Create new form
					const codeForm = Object.assign(document.createElement("form"), {
						// Create form element
						action: "",
						autocomplete: "off",
						method: "POST"
					});
					codeForm.append(
						Object.assign(document.createElement("input"), {
							// Code box

							autocomplete: "off",
							// eslint-disable-next-line id-length -- We didn't name this.
							id: "code",
							name: "code",
							placeholder: "abcde12345",
							required: "true",
							type: "password"
						}),
						Object.assign(document.createElement("input"), {
							// Hidden email box

							name: "email",
							type: "hidden",
							value: email
						}),
						Object.assign(document.createElement("button"), {
							// Submit button

							// eslint-disable-next-line id-length -- We didn't name this.
							id: "submit",
							innerText: "{{ #message }}emailSubmit{{ /message }}",
							type: "submit"
						})
					);
					form.remove();
					document.querySelector("#note").remove();
					document.querySelector("main").append(
						Object.assign(document.createElement("label"), {
							htmlFor: "code",
							// eslint-disable-next-line id-length -- We didn't name this.
							id: "note",
							innerText: "{{ #message }}emailEnterCode{{ /message }}"
						}),
						codeForm
					);
				}
				form.addEventListener("submit", onSubmit);
			})();
		</script>
	</body>
</html>
