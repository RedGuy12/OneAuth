<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Sign in with email | 1Auth</title>
		<noscript>
			<meta http-equiv="refresh" content="0; url=/old/" />
		</noscript>
		{{> googletagmanager}}
	</head>

	<body style="display: none">
		{{> nav}}
		<main>
			<h1>Login with Email</h1>
			<label for="email-address" id="note">Enter your email to continue</label>
			<form action="" method="POST">
				<input
					id="email-address"
					name="email"
					type="email"
					autocomplete="email"
					required="true"
					placeholder="Email address"
				/>
				<button type="submit" id="submit">Submit</button>
			</form>
		</main>
		<script>
			document.querySelector("form").addEventListener("submit", async (e) => {
				e.preventDefault();

				// Show loading icon
				const submit = document.querySelector('[type="submit"]');
				submit.firstChild.remove();
				submit.append(
					Object.assign(document.createElement("img"), {
						src: "/svg/loading",
					}),
				);

				// Save email for later
				const email = document.querySelector("input").value;

				// Send the email
				await fetch("", {
					headers: {
						"content-type": "application/x-www-form-urlencoded; charset=UTF-8",
					},
					body: "email=" + email,
					method: "POST",
				});

				// Create new form
				var form = Object.assign(document.createElement("form"), {
					// main form
					action: "",
					method: "POST",
					autocomplete: "off",
				});
				form.appendChild(
					Object.assign(document.createElement("input"), {
						// code box
						type: "password",
						name: "code",
						placeholder: "abcde12345",
						autocomplete: "off",
						required: "true",
						id: "code",
					}),
					Object.assign(document.createElement("input"), {
						// hidden email box
						type: "hidden",
						name: "email",
						value: email,
					}),
					Object.assign(document.createElement("input"), {
						// submit button
						type: "submit",
						id: "submit",
					}),
				);
				document.querySelector("form").remove();
				document.querySelector("#note").remove();
				document.querySelector("main").appendChild(
					Object.assign(document.createElement("label"), {
						htmlFor: "code",
						id: "note",
						innerText: "Enter the code we sent to you to continue",
					}),
					form,
				);
			});
		</script>
	</body>
</html>
